<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدیریت اشتراک VPN</title>
    
    <!-- Persian Date Picker Library -->
    <link rel="stylesheet" href="https://unpkg.com/@majidh1/jalalidatepicker/dist/jalalidatepicker.min.css">
    
    <!-- Google Fonts - Vazirmatn -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- General Styles & Variables --- */
        :root {
            --primary-color: #008B8B; /* Dark Cyan */
            --secondary-color: #f0f5f5;
            --light-color: #ffffff;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --archive-color: #7f8c8d;
            --shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            --border-radius: 10px;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--secondary-color);
            color: var(--dark-color);
            line-height: 1.7;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .hidden {
            display: none !important;
        }

        /* --- Login Screen Styles --- */
        #login-screen {
            background-color: var(--light-color);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            width: 100%;
            max-width: 380px;
        }

        #login-screen h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        #login-screen .form-group {
            margin-bottom: 20px;
        }

        #login-screen input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-family: 'Vazirmatn', sans-serif;
            box-sizing: border-box;
            text-align: center;
            font-size: 16px;
        }
        
        #login-screen .btn {
            width: 100%;
        }
        
        #error-message {
            color: var(--danger-color);
            margin-top: 15px;
            font-weight: 500;
            min-height: 20px;
        }


        /* --- Main App Styles --- */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 20px;
            padding: 30px;
            background: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h1, h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
        }

        /* --- Form Styles --- */
        #subscriptionForm {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="tel"],
        input[type="url"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Vazirmatn', sans-serif;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #fdfdfd;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.15);
        }

        .form-buttons {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            color: var(--light-color);
            cursor: pointer;
            font-size: 16px;
            font-family: 'Vazirmatn', sans-serif;
            font-weight: 500;
            transition: all 0.3s;
            flex-grow: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-submit { background-color: var(--primary-color); }
        .btn-toggle-archive { background-color: var(--archive-color); }

        /* --- Table Styles --- */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            text-align: right;
            font-size: 14px;
        }

        th, td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #f8f9fa;
            color: var(--dark-color);
            font-weight: 700;
            text-align: right;
        }

        tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        
        tr:hover {
            background-color: #e9ecef;
        }
        
        td.link-cell {
            max-width: 250px;
            word-wrap: break-word;
            word-break: break-all;
            text-align: left;
            direction: ltr;
        }
        
        td.link-cell a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        td.link-cell a:hover {
            text-decoration: underline;
        }

        td.actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            min-width: 200px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: transform 0.2s;
        }
        .action-btn:hover {
            transform: scale(1.05);
        }
        .btn-edit { background-color: var(--warning-color); color: var(--dark-color); }
        .btn-delete { background-color: var(--danger-color); }
        .btn-archive { background-color: var(--success-color); }
        .btn-unarchive { background-color: #3498db; }

    </style>
</head>
<body>
    
    <div id="login-screen">
        <h2>ورود به پنل مدیریت</h2>
        <form id="loginForm">
            <div class="form-group">
                <input type="password" id="password" placeholder="رمز عبور را وارد کنید" required>
            </div>
            <button type="submit" class="btn btn-submit">ورود</button>
            <p id="error-message"></p>
        </form>
    </div>

    <div class="container hidden" id="main-app">
        <h1>📝 مدیریت اشتراک VPN</h1>
        
        <form id="subscriptionForm">
            <input type="hidden" id="editId">
            <div class="form-group">
                <label for="customerName">نام مشتری</label>
                <input type="text" id="customerName" required placeholder="مثال: علی رضایی">
            </div>
            <div class="form-group">
                <label for="phoneNumber">شماره تماس</label>
                <input type="tel" id="phoneNumber" placeholder="مثال: 09123456789">
            </div>
            <div class="form-group">
                <label for="botUsername">نام کاربری در ربات</label>
                <input type="text" id="botUsername" placeholder="مثال: @username">
            </div>
            <div class="form-group">
                <label for="botName">انتخاب ربات</label>
                <select id="botName">
                    <option value="Lemos">Lemos</option>
                    <option value="Sabz">Sabz</option>
                </select>
            </div>
             <div class="form-group">
                <label for="subscriptionDate">تاریخ</label>
                <input type="text" id="subscriptionDate" data-jdp required autocomplete="off" placeholder="تاریخ را انتخاب کنید">
            </div>
            <div class="form-group">
                <label for="subscriptionVolume">حجم اشتراک (GB)</label>
                <input type="number" id="subscriptionVolume" min="1" placeholder="مثال: 50">
            </div>
            <div class="form-group" style="grid-column: 1 / -1;">
                <label for="subscriptionLink">لینک اشتراک</label>
                <input type="url" id="subscriptionLink" placeholder="لینک کامل را وارد کنید">
            </div>
           
            <div class="form-buttons">
                 <button type="submit" class="btn btn-submit" id="submitBtn">ثبت اطلاعات</button>
            </div>
        </form>
        
        <div class="form-buttons" style="margin-top: 20px;">
            <button class="btn btn-toggle-archive" id="toggleArchiveView">🗄️ مشاهده بایگانی</button>
        </div>


        <div id="activeSubscriptions">
            <h2>لیست اشتراک‌های فعال</h2>
            <div class="table-container">
                <table id="activeTable">
                    <thead>
                        <tr>
                            <th>نام مشتری</th>
                            <th>شماره تماس</th>
                            <th>ربات</th>
                            <th>تاریخ</th>
                            <th>حجم (GB)</th>
                            <th>لینک</th>
                            <th style="text-align: center;">عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="activeBody"></tbody>
                </table>
            </div>
        </div>
        
        <div id="archivedSubscriptions" class="hidden">
            <h2>لیست بایگانی</h2>
            <div class="table-container">
                <table id="archivedTable">
                     <thead>
                        <tr>
                            <th>نام مشتری</th>
                            <th>شماره تماس</th>
                            <th>ربات</th>
                            <th>تاریخ</th>
                            <th>حجم (GB)</th>
                            <th>لینک</th>
                            <th style="text-align: center;">عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="archivedBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Jalali Date Picker Script -->
    <script src="https://unpkg.com/@majidh1/jalalidatepicker/dist/jalalidatepicker.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- LOGIN LOGIC ---
            const loginScreen = document.getElementById('login-screen');
            const mainApp = document.getElementById('main-app');
            const loginForm = document.getElementById('loginForm');
            const passwordInput = document.getElementById('password');
            const errorMessage = document.getElementById('error-message');

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (passwordInput.value === '4006') {
                    loginScreen.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    initializeApp();
                } else {
                    errorMessage.textContent = 'رمز عبور اشتباه است!';
                    passwordInput.value = '';
                }
            });


            // --- MAIN APP LOGIC ---
            function initializeApp() {
                // Initialize Date Picker
                jalaliDatepicker.startWatch({
                    time: false,
                    todayButton: true,
                    gotoToday: true,
                    init: true 
                });

                // DOM Elements
                const form = document.getElementById('subscriptionForm');
                const submitBtn = document.getElementById('submitBtn');
                const editIdInput = document.getElementById('editId');
                const toggleArchiveViewBtn = document.getElementById('toggleArchiveView');
                const activeBody = document.getElementById('activeBody');
                const archivedBody = document.getElementById('archivedBody');
                const activeContainer = document.getElementById('activeSubscriptions');
                const archivedContainer = document.getElementById('archivedSubscriptions');
                
                // Data Arrays from Local Storage
                let subscriptions = JSON.parse(localStorage.getItem('vpn_subscriptions_active')) || [];
                let archived = JSON.parse(localStorage.getItem('vpn_subscriptions_archived')) || [];

                // Render initial data
                renderTables();

                // Form submission logic
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const subscriptionData = {
                        customerName: document.getElementById('customerName').value.trim(),
                        phoneNumber: document.getElementById('phoneNumber').value.trim(),
                        botUsername: document.getElementById('botUsername').value.trim(),
                        botName: document.getElementById('botName').value,
                        subscriptionDate: document.getElementById('subscriptionDate').value,
                        subscriptionLink: document.getElementById('subscriptionLink').value.trim(),
                        subscriptionVolume: document.getElementById('subscriptionVolume').value,
                    };

                    const editId = editIdInput.value;
                    if (editId) { // Update existing subscription
                        const index = subscriptions.findIndex(sub => sub.id == editId);
                        if (index !== -1) {
                            subscriptions[index] = { ...subscriptions[index], ...subscriptionData };
                        }
                        submitBtn.textContent = 'ثبت اطلاعات';
                        submitBtn.style.backgroundColor = 'var(--primary-color)';
                        editIdInput.value = '';
                    } else { // Create new subscription
                        subscriptionData.id = Date.now(); // Unique ID
                        subscriptions.push(subscriptionData);
                    }
                    
                    saveAndRender();
                    form.reset();
                    jalaliDatepicker.updateOptions({init: true});
                });

                // Toggle archive view visibility
                toggleArchiveViewBtn.addEventListener('click', () => {
                    const isHidden = archivedContainer.classList.toggle('hidden');
                    activeContainer.classList.toggle('hidden');
                    toggleArchiveViewBtn.textContent = isHidden ? '🗄️ مشاهده بایگانی' : '✅ مشاهده لیست فعال';
                });

                // Handle all actions using event delegation
                document.body.addEventListener('click', (e) => {
                    const target = e.target.closest('.action-btn');
                    if (!target) return;

                    const id = target.dataset.id;
                    
                    if (target.classList.contains('edit-btn')) handleEdit(id);
                    else if (target.classList.contains('delete-btn')) handleDelete(id, target.dataset.list);
                    else if (target.classList.contains('archive-btn')) handleArchive(id);
                    else if (target.classList.contains('unarchive-btn')) handleUnarchive(id);
                });

                function handleEdit(id) {
                    const sub = subscriptions.find(s => s.id == id);
                    if (!sub) return;

                    document.getElementById('customerName').value = sub.customerName;
                    document.getElementById('phoneNumber').value = sub.phoneNumber;
                    document.getElementById('botUsername').value = sub.botUsername;
                    document.getElementById('botName').value = sub.botName;
                    document.getElementById('subscriptionDate').value = sub.subscriptionDate;
                    document.getElementById('subscriptionLink').value = sub.subscriptionLink;
                    document.getElementById('subscriptionVolume').value = sub.subscriptionVolume;
                    
                    editIdInput.value = id;
                    submitBtn.textContent = 'بروزرسانی اطلاعات';
                    submitBtn.style.backgroundColor = 'var(--warning-color)';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    document.getElementById('customerName').focus();
                }

                function handleDelete(id, listType) {
                    if (confirm('آیا از حذف این اشتراک اطمینان دارید؟ این عمل غیرقابل بازگشت است.')) {
                        if (listType === 'active') {
                            subscriptions = subscriptions.filter(s => s.id != id);
                        } else if (listType === 'archived') {
                            archived = archived.filter(s => s.id != id);
                        }
                        saveAndRender();
                    }
                }

                function handleArchive(id) {
                    const index = subscriptions.findIndex(s => s.id == id);
                    if (index > -1) {
                        const [item] = subscriptions.splice(index, 1);
                        archived.push(item);
                        saveAndRender();
                    }
                }

                function handleUnarchive(id) {
                    const index = archived.findIndex(s => s.id == id);
                    if (index > -1) {
                        const [item] = archived.splice(index, 1);
                        subscriptions.push(item);
                        saveAndRender();
                    }
                }

                function saveAndRender() {
                    localStorage.setItem('vpn_subscriptions_active', JSON.stringify(subscriptions));
                    localStorage.setItem('vpn_subscriptions_archived', JSON.stringify(archived));
                    renderTables();
                }

                function renderTables() {
                    activeBody.innerHTML = subscriptions.map(sub => createRow(sub, 'active')).join('');
                    archivedBody.innerHTML = archived.map(sub => createRow(sub, 'archived')).join('');
                }

                function createRow(sub, type) {
                    const archiveButtons = type === 'active' 
                        ? `<button class="action-btn btn-archive" data-id="${sub.id}">بایگانی</button>`
                        : `<button class="action-btn btn-unarchive" data-id="${sub.id}">بازگردانی</button>`;
                    
                    const editButton = type === 'active'
                        ? `<button class="action-btn btn-edit" data-id="${sub.id}">ویرایش</button>`
                        : '';

                    return `
                        <tr>
                            <td>${sub.customerName || '-'}</td>
                            <td>${sub.phoneNumber || '-'}</td>
                            <td>${sub.botName || '-'}</td>
                            <td>${sub.subscriptionDate || '-'}</td>
                            <td>${sub.subscriptionVolume ? sub.subscriptionVolume + ' GB' : '-'}</td>
                            <td class="link-cell">${sub.subscriptionLink ? `<a href="${sub.subscriptionLink}" target="_blank" rel="noopener noreferrer">${sub.subscriptionLink}</a>` : '-'}</td>
                            <td class="actions">
                                ${editButton}
                                <button class="action-btn btn-delete" data-id="${sub.id}" data-list="${type}">حذف</button>
                                ${archiveButtons}
                            </td>
                        </tr>
                    `;
                }
            }
        });
    </script>

</body>
</html>
